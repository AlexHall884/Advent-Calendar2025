<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Современный Адвент Календарь</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0F1A2B;
            --secondary: #1A2A3F;
            --accent: #FF3366;
            --accent-light: #FF6B9C;
            --gold: #FFD166;
            --light: #FFFFFF;
            --success: #06D6A0;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: 
                linear-gradient(135deg, rgba(15, 26, 43, 0.9) 0%, rgba(26, 42, 63, 0.9) 100%),
                url('https://images.unsplash.com/photo-1545486332-9e0999c535b2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') center/cover fixed;
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Montserrat', sans-serif;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            padding: 40px 20px;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--light) 0%, var(--gold) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 16px;
            font-family: 'Playfair Display', serif;
        }

        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 20px;
            font-weight: 400;
            line-height: 1.6;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 24px;
            width: 100%;
            max-width: 1000px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .controls.collapsed {
            display: none;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--light);
        }

        select, input, button {
            padding: 16px 20px;
            border-radius: 16px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            width: 100%;
            transition: var(--transition);
            border: 1px solid var(--glass-border);
            font-family: 'Montserrat', sans-serif;
        }

        /* Исправление для выпадающих списков */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
            padding-right: 50px;
        }

        /* Стили для опций в выпадающем списке */
        select option {
            background: var(--primary);
            color: white;
            padding: 12px;
        }

        button {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 8px 32px rgba(255, 51, 102, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(255, 51, 102, 0.4);
        }

        button.secondary {
            background: var(--secondary);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            width: 100%;
            margin-bottom: 40px;
        }

        .day {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
        }

        .day:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .day-number {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--gold);
            margin-bottom: 8px;
        }

        .day-date {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 8px;
        }

        .day-task {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        .completed {
            background: linear-gradient(135deg, rgba(6, 214, 160, 0.2) 0%, rgba(6, 214, 160, 0.1) 100%);
        }

        .completed .day-number {
            color: var(--success);
        }

        .today {
            border: 2px solid var(--accent);
            box-shadow: 0 0 30px rgba(255, 51, 102, 0.4);
        }

        .task-modal, .countdown-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 26, 43, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--glass);
            backdrop-filter: blur(30px);
            padding: 40px;
            border-radius: 24px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
            animation: modalAppear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .countdown-content {
            background: var(--glass);
            backdrop-filter: blur(30px);
            padding: 40px;
            border-radius: 24px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
            animation: modalAppear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--light) 0%, var(--gold) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-family: 'Playfair Display', serif;
        }

        .countdown-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--light) 0%, var(--gold) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-family: 'Playfair Display', serif;
        }

        .countdown-number {
            font-size: 4rem;
            font-weight: 800;
            color: var(--accent);
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 51, 102, 0.5);
        }

        .countdown-text {
            font-size: 1.3rem;
            margin-bottom: 30px;
        }

        .modal-task {
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 4px solid var(--accent);
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .hidden {
            display: none;
        }

        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .snowflake {
            position: absolute;
            top: -20px;
            color: white;
            font-size: 1rem;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        .garland {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 40px;
            z-index: 50;
            pointer-events: none;
        }

        .light {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            animation: flicker 2s infinite alternate;
            box-shadow: 0 0 10px currentColor;
            filter: brightness(1.2);
        }

        /* Улучшенная анимация гирлянды */
        @keyframes flicker {
            0%, 100% { 
                opacity: 0.4; 
                transform: scale(0.8);
            }
            5%, 15%, 25%, 35%, 45%, 55%, 65%, 75%, 85%, 95% { 
                opacity: 1; 
                transform: scale(1.1);
            }
            10%, 20%, 30%, 40%, 50%, 60%, 70%, 80%, 90% { 
                opacity: 0.7; 
                transform: scale(0.9);
            }
        }

        /* Добавляем эффект "размытия" для более мягкого свечения */
        .light::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: currentColor;
            transform: translate(-50%, -50%);
            filter: blur(4px);
            opacity: 0.3;
            z-index: -1;
        }

        @media (max-width: 768px) {
            .calendar {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            h1 {
                font-size: 2.5rem;
            }
            .controls {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            .header-controls {
                flex-direction: column;
            }
            .modal-content, .countdown-content {
                padding: 30px 20px;
            }
            .countdown-number {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="snowflakes" id="snowflakes"></div>
    <div class="garland" id="garland"></div>
    
    <div class="container">
        <header>
            <h1>Адвент Календарь</h1>
            <p class="subtitle">Открывайте задания каждый день и создавайте праздничное настроение!</p>
            <div class="header-controls">
                <button id="toggle-controls">Скрыть настройки</button>
                <button id="days-to-ny">Сколько дней до Нового года?</button>
            </div>
        </header>
        
        <div class="controls" id="controls">
            <div class="control-group">
                <label for="duration">Продолжительность:</label>
                <select id="duration">
                    <option value="7">Неделя (7 дней)</option>
                    <option value="24" selected>24 дня (классический)</option>
                    <option value="31">31 день (полный декабрь)</option>
                    <option value="custom">Своё количество</option>
                </select>
            </div>
            
            <div class="control-group" id="custom-days-container" style="display: none;">
                <label for="custom-days">Количество дней:</label>
                <input type="number" id="custom-days" min="1" max="100" value="65">
            </div>
            
            <div class="control-group">
                <label for="mode">Режим заданий:</label>
                <select id="mode">
                    <option value="standard">Стандартный</option>
                    <option value="child">Детский</option>
                    <option value="family">Семейный</option>
                    <option value="romantic">Романтический</option>
                </select>
            </div>
            
            <div class="control-group">
                <button id="generate-btn">Сгенерировать календарь</button>
            </div>
            
            <div class="control-group">
                <button id="reset-btn" class="secondary">Сбросить прогресс</button>
            </div>
        </div>
        
        <div class="calendar" id="calendar"></div>
    </div>
    
    <div class="task-modal hidden" id="task-modal">
        <div class="modal-content">
            <h2 class="modal-title">Задание на <span id="modal-date"></span></h2>
            <p class="modal-task" id="modal-task"></p>
            <div class="modal-buttons">
                <button id="complete-btn">Выполнено!</button>
                <button id="close-modal" class="secondary">Закрыть</button>
            </div>
        </div>
    </div>

    <div class="countdown-modal hidden" id="countdown-modal">
        <div class="countdown-content">
            <h2 class="countdown-title">До Нового года осталось:</h2>
            <div class="countdown-number" id="countdown-days">0</div>
            <div class="countdown-text">дней</div>
            <button id="close-countdown" class="secondary">Закрыть</button>
        </div>
    </div>

    <script>
        // Задания для разных режимов
        const taskLists = {
            standard: [
                "Посмотреть новогодний фильм",
                "Приготовить горячий шоколад",
                "Написать список благодарностей за год",
                "Сделать уборку к праздникам",
                "Написать письмо с пожеланиями на следующий год",
                "Создать плейлист с любимыми песнями",
                "Украсить дом к праздникам",
                "Сделать фотосессию в новогодней тематике",
                "Написать план на следующий год",
                "Приготовить особое блюдо",
                "Сделать зимнюю прогулку",
                "Прочитать книгу или рассказ",
                "Сделать доброе дело",
                "Устроить вечер воспоминаний",
                "Создать handmade-украшение",
                "Приготовить имбирное печенье",
                "Написать письмо Деду Морозу",
                "Устроить день без гаджетов",
                "Приготовить сюрприз для семьи",
                "Встретить рассвет",
                "Сделать снежинки из бумаги",
                "Устроить вечер настольных игр",
                "Написать новогодние открытки",
                "Сделать зимний коллаж"
            ],
            child: [
                "Нарисовать зимний рисунок",
                "Сделать бумажную снежинку",
                "Написать письмо Деду Морозу",
                "Посмотреть новогодний мультфильм",
                "Сделать кормушку для птиц",
                "Украсить свою комнату к празднику",
                "Выучить новогоднее стихотворение",
                "Сделать поделку на ёлку",
                "Приготовить простое новогоднее печенье с родителями",
                "Написать список подарков, которые хочешь подарить близким",
                "Поиграть в снежки или слепить снеговика",
                "Сделать гирлянду из цветной бумаги",
                "Рассказать родным о самом запоминающемся событии года",
                "Сделать новогоднюю открытку своими руками",
                "Почитать зимнюю сказку перед сном",
                "Устроить домашний спектакль про Новый год",
                "Сделать ангелочка из бумаги",
                "Написать пожелания всем членам семьи",
                "Выучить новогоднюю песню",
                "Сделать ёлочную игрушку из подручных материалов",
                "Придумать новогоднюю историю",
                "Устроить танцы под новогодние песни",
                "Сделать фотографию с семьёй у ёлки",
                "Приготовить горячий шоколад с зефирками"
            ],
            family: [
                "Устроить семейный киновечер",
                "Сделать домашнюю пиццу вместе",
                "Собрать пазл всей семьей",
                "Поиграть в настольные игры",
                "Сделать семейное фото у ёлки",
                "Приготовить ужин всем вместе",
                "Создать семейную капсулу времени",
                "Устроить танцевальный баттл",
                "Создать семейный новогодний альбом",
                "Испечь печенье и украсить его вместе",
                "Поиграть в шарады",
                "Сделать домашний театр",
                "Устроить пикник на полу в гостиной",
                "Создать плейлист с песнями каждого члена семьи",
                "Сделать семейную гирлянду",
                "Почитать вслух зимние истории",
                "Создать семейный коллаж желаний",
                "Устроить вечер воспоминаний",
                "Создать семейную традицию",
                "Сделать благотворительную акцию вместе",
                "Устроить домашний квест",
                "Создать семейный новогодний ритуал"
            ],
            romantic: [
                "Приготовить романтический ужин при свечах",
                "Написать любовное письмо партнеру",
                "Устроить вечер танцев под медленную музыку",
                "Сделать массаж друг другу",
                "Посмотреть вместе закат",
                "Создать плейлист с песнями, которые вас связывают",
                "Устроить пикник с пледом и горячим чаем",
                "Написать 10 причин, почему вы любите друг друга",
                "Сделать совместную фотокнигу ваших воспоминаний",
                "Приготовить завтрак в постель",
                "Устроить вечер настольных игр для двоих",
                "Сходить на зимнюю прогулку под луной",
                "Сделать совместное желание под первую звезду",
                "Принять ванну с аромамаслами и свечами",
                "Написать сценарий вашего идеального свидания",
                "Создать совместный коллаж мечтаний",
                "Устроить киномарафон любимых фильмов",
                "Сделать друг другу подарки своими руками",
                "Написать обещания друг другу на следующий год",
                "Устроить дегустацию вин или сыров",
                "Создать капсулу времени с вашими воспоминаниями",
                "Сходить на каток и выпить горячего шоколада",
                "Сделать совместный уходовый ритуал",
                "Написать историю вашей любви"
            ]
        };

        // Специальные задания для 31 декабря по режимам
        const newYearTasks = {
            standard: "Загадать желание под бой курантов и встретить Новый год в кругу близких",
            child: "Встретить Новый год с семьей и загадать желание под бой курантов",
            family: "Встретить Новый год вместе и загадать семейное желание под бой курантов",
            romantic: "Встретить Новый год вместе и загадать желание под бой курантов на следующий год"
        };

        const specialTask = "Посетить открытие зимнего сезона в городском парке культуры и отдыха города Калуги в 15:00";

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Создание снежинок и гирлянды
            createSnowflakes();
            createGarland();
            
            // Настройка обработчиков событий
            document.getElementById('duration').addEventListener('change', handleDurationChange);
            document.getElementById('generate-btn').addEventListener('click', generateCalendar);
            document.getElementById('reset-btn').addEventListener('click', resetProgress);
            document.getElementById('toggle-controls').addEventListener('click', toggleControls);
            document.getElementById('days-to-ny').addEventListener('click', showDaysToNewYear);
            document.getElementById('complete-btn').addEventListener('click', completeTask);
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('close-countdown').addEventListener('click', closeCountdown);
            
            // Загрузка сохраненных данных и генерация календаря
            loadSavedData();
            generateCalendar();
        });

        function handleDurationChange() {
            const customContainer = document.getElementById('custom-days-container');
            if (document.getElementById('duration').value === 'custom') {
                customContainer.style.display = 'flex';
            } else {
                customContainer.style.display = 'none';
            }
        }

        function toggleControls() {
            const controls = document.getElementById('controls');
            const button = document.getElementById('toggle-controls');
            
            if (controls.classList.contains('collapsed')) {
                controls.classList.remove('collapsed');
                button.textContent = 'Скрыть настройки';
            } else {
                controls.classList.add('collapsed');
                button.textContent = 'Показать настройки';
            }
        }

        function showDaysToNewYear() {
            const today = new Date();
            const newYear = new Date(today.getFullYear() + 1, 0, 1);
            const diffTime = newYear - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            document.getElementById('countdown-days').textContent = diffDays;
            document.getElementById('countdown-modal').classList.remove('hidden');
        }

        function closeCountdown() {
            document.getElementById('countdown-modal').classList.add('hidden');
        }

        function createSnowflakes() {
            const snowflakes = document.getElementById('snowflakes');
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = '❄';
                snowflake.style.left = `${Math.random() * 100}%`;
                snowflake.style.animationDuration = `${Math.random() * 8 + 8}s`;
                snowflake.style.animationDelay = `${Math.random() * 5}s`;
                snowflake.style.opacity = Math.random() * 0.7 + 0.3;
                snowflakes.appendChild(snowflake);
            }
        }

        function createGarland() {
            const garland = document.getElementById('garland');
            const colors = ['#FF3366', '#FFD166', '#06D6A0', '#118AB2', '#EF476F'];
            const lightCount = Math.floor(window.innerWidth / 30);
            
            for (let i = 0; i < lightCount; i++) {
                const light = document.createElement('div');
                light.className = 'light';
                light.style.left = `${(i / lightCount) * 100}%`;
                light.style.top = `${Math.random() * 15}px`; // Случайное вертикальное положение
                light.style.backgroundColor = colors[i % colors.length];
                
                // Разные скорости мерцания для более естественного эффекта
                const duration = Math.random() * 1.5 + 1.5; // от 1.5 до 3 секунд
                const delay = Math.random() * 2; // случайная задержка до 2 секунд
                
                light.style.animation = `flicker ${duration}s ${delay}s infinite alternate`;
                
                garland.appendChild(light);
            }
        }

        function generateCalendar() {
            const daysCount = getDaysCount();
            const mode = document.getElementById('mode').value;
            const dates = generateDates(daysCount);
            const tasks = generateTasks(daysCount, mode, dates);
            
            saveSettings(daysCount, mode, tasks, dates);
            renderCalendar(dates, tasks);
        }

        function getDaysCount() {
            const duration = document.getElementById('duration').value;
            if (duration === 'custom') {
                return parseInt(document.getElementById('custom-days').value) || 65;
            }
            return parseInt(duration);
        }

        function generateDates(daysCount) {
            const currentYear = new Date().getFullYear();
            const endDate = new Date(currentYear, 11, 31);
            const dates = [];
            
            for (let i = daysCount - 1; i >= 0; i--) {
                const date = new Date(endDate);
                date.setDate(endDate.getDate() - i);
                dates.push(date);
            }
            
            return dates;
        }

        function generateTasks(daysCount, mode, dates) {
            const baseTasks = [...taskLists[mode]];
            const tasks = [];
            
            // Перемешиваем задания
            for (let i = baseTasks.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [baseTasks[i], baseTasks[j]] = [baseTasks[j], baseTasks[i]];
            }
            
            // Назначаем задания дням
            for (let i = 0; i < daysCount; i++) {
                const date = dates[i];
                
                // Проверяем специальные даты
                if (date.getDate() === 27 && date.getMonth() === 11) {
                    tasks.push(specialTask);
                } else if (date.getDate() === 31 && date.getMonth() === 11) {
                    tasks.push(newYearTasks[mode]);
                } else {
                    tasks.push(baseTasks[i % baseTasks.length]);
                }
            }
            
            return tasks;
        }

        function renderCalendar(dates, tasks) {
            const calendar = document.getElementById('calendar');
            const completedDates = JSON.parse(localStorage.getItem('adventCompleted') || '[]');
            
            calendar.innerHTML = '';
            
            dates.forEach((date, index) => {
                const dayElement = createDayElement(date, index + 1, tasks[index], completedDates);
                calendar.appendChild(dayElement);
            });
        }

        function createDayElement(date, dayNumber, task, completedDates) {
            const dayEl = document.createElement('div');
            dayEl.className = 'day';
            dayEl.dataset.date = date.toISOString();
            
            // Проверяем, является ли день сегодняшним
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayEl.classList.add('today');
            }
            
            // Проверяем, выполнен ли день
            if (completedDates.includes(date.toISOString())) {
                dayEl.classList.add('completed');
            }
            
            const dateStr = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}`;
            
            dayEl.innerHTML = `
                <div class="day-number">${dayNumber}</div>
                <div class="day-date">${dateStr}</div>
                <div class="day-task">${completedDates.includes(date.toISOString()) ? '✓ Выполнено!' : 'Нажми, чтобы открыть'}</div>
            `;
            
            dayEl.addEventListener('click', () => openTaskModal(date, task, completedDates));
            
            return dayEl;
        }

        function openTaskModal(date, task, completedDates) {
            document.getElementById('modal-date').textContent = `${date.getDate()} декабря`;
            document.getElementById('modal-task').textContent = task;
            
            const completeBtn = document.getElementById('complete-btn');
            if (completedDates.includes(date.toISOString())) {
                completeBtn.textContent = 'Уже выполнено!';
                completeBtn.disabled = true;
            } else {
                completeBtn.textContent = 'Выполнено!';
                completeBtn.disabled = false;
                completeBtn.dataset.date = date.toISOString();
            }
            
            document.getElementById('task-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('task-modal').classList.add('hidden');
        }

        function completeTask() {
            const date = document.getElementById('complete-btn').dataset.date;
            const completedDates = JSON.parse(localStorage.getItem('adventCompleted') || '[]');
            
            if (!completedDates.includes(date)) {
                completedDates.push(date);
                localStorage.setItem('adventCompleted', JSON.stringify(completedDates));
                
                // Обновляем отображение
                const dayEl = document.querySelector(`.day[data-date="${date}"]`);
                if (dayEl) {
                    dayEl.classList.add('completed');
                    dayEl.querySelector('.day-task').textContent = '✓ Выполнено!';
                }
                
                closeModal();
            }
        }

        function resetProgress() {
            if (confirm('Вы уверены, что хотите сбросить весь прогресс?')) {
                localStorage.removeItem('adventCompleted');
                generateCalendar();
            }
        }

        function saveSettings(daysCount, mode, tasks, dates) {
            localStorage.setItem('adventDays', daysCount);
            localStorage.setItem('adventMode', mode);
            localStorage.setItem('adventTasks', JSON.stringify(tasks));
            localStorage.setItem('adventDates', JSON.stringify(dates.map(d => d.toISOString())));
        }

        function loadSavedData() {
            const savedDays = localStorage.getItem('adventDays');
            const savedMode = localStorage.getItem('adventMode');
            
            if (savedDays) {
                if (['7', '24', '31'].includes(savedDays)) {
                    document.getElementById('duration').value = savedDays;
                } else {
                    document.getElementById('duration').value = 'custom';
                    document.getElementById('custom-days').value = savedDays;
                    document.getElementById('custom-days-container').style.display = 'flex';
                }
            }
            
            if (savedMode) {
                document.getElementById('mode').value = savedMode;
            }
        }
    </script>
</body>
</html>